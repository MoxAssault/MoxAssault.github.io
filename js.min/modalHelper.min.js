function addYMLFieldInput(fieldDef,container){const t=(fieldDef.type||"").toLowerCase();if(fieldDef.toggle){const wrap=document.createElement("div");wrap.className="modal-field-override-wrap";const cb=document.createElement("input");cb.type="checkbox";cb.id=`modal-toggle-${fieldDef.yml_field}`;cb.name=fieldDef.yml_field+"_enabled";const lbl=document.createElement("label");lbl.setAttribute("for",cb.id);let inp;inp=document.createElement("input");inp.type="text";inp.placeholder=fieldDef.name;inp.id=`modal-input-${fieldDef.yml_field}`;inp.name=fieldDef.yml_field;inp.readOnly=true;cb.addEventListener("change",(()=>{inp.readOnly=!cb.checked}));inp.addEventListener("focus",(()=>{if(inp.readOnly){cb.checked=true;inp.readOnly=false;inp.focus()}}));inp.addEventListener("blur",(()=>{if(!inp.readOnly&&!inp.value){cb.checked=false;inp.readOnly=true;inp.blur()}}));wrap.append(cb,lbl,inp);container.appendChild(wrap);return}if(t==="array"&&Array.isArray(fieldDef.items)){const wrap=document.createElement("div");wrap.className="modal-array-fixed-wrap";const groupLabel=document.createElement("span");groupLabel.className="modal-group-label";groupLabel.textContent=fieldDef.name+":";wrap.appendChild(groupLabel);fieldDef.items.forEach((itemDef=>{const cb=document.createElement("input");cb.type="checkbox";cb.id=`modal-input-${fieldDef.yml_field}-${itemDef.yml_field}`;cb.name=fieldDef.yml_field;cb.value=itemDef.yml_field;const itemLabel=document.createElement("label");itemLabel.className="modal-inline-label";itemLabel.setAttribute("for",cb.id);itemLabel.textContent=itemDef.name;wrap.append(cb,itemLabel)}));container.appendChild(wrap);return}let inputEl;if(t==="bool"){const wrap=document.createElement("label");wrap.className="modal-field-bool-wrap";const cb=document.createElement("input");cb.type="checkbox";cb.id="modal-input-"+fieldDef.yml_field;cb.name=fieldDef.yml_field;wrap.append(cb,document.createTextNode(fieldDef.name));container.appendChild(wrap);return}else if(t==="int"){inputEl=document.createElement("input");inputEl.type="number";inputEl.max=120;if(fieldDef.yml_field==="fps"){inputEl.setAttribute("maxlength","3");inputEl.style.width="4rem"}}else if(t==="str"&&fieldDef.multiline){inputEl=document.createElement("textarea");inputEl.rows=fieldDef.rows||3}else if(t==="str"){inputEl=document.createElement("input");inputEl.type="text"}else if(t==="array"){inputEl=document.createElement("textarea");inputEl.rows=fieldDef.rows||3}else{console.warn("Unknown field type",fieldDef);return}inputEl.id="modal-input-"+fieldDef.yml_field;inputEl.placeholder=fieldDef.name;const label=document.createElement("label");label.className="modal-field-label";label.setAttribute("for",inputEl.id);const wrap=document.createElement("div");wrap.className="modal-field-wrap";wrap.append(label,inputEl);container.appendChild(wrap)}function showModal(sections,onSubmit){const overlay=document.getElementById("submitModal");const fieldsDiv=document.getElementById("modalFields");const btnClose=document.getElementById("closeModalBtn");const btnSubmit=document.getElementById("confirmSubmitBtn");if(!overlay||!fieldsDiv||!btnClose||!btnSubmit){console.error("showModal: missing one of submitModal/modalFields/closeModalBtn/confirmSubmitBtn");return}fieldsDiv.innerHTML="";function extractFlag(fields,key){const idx=fields.findIndex((f=>f.yml_field===key));return idx>=0?fields.splice(idx,1)[0]:null}sections.forEach((sec=>{let flagField=null;if(sec.title==="Backglass (B2S)"){flagField=extractFlag(sec.fields,"backglassBundled")}else if(sec.title==="ROM Files"){flagField=extractFlag(sec.fields,"romBundled")}else if(sec.title==="Color ROM Files"){flagField=extractFlag(sec.fields,"coloredROMBundled")}else if(sec.title==="PUP Pack"){flagField=extractFlag(sec.fields,"pupRequired")}const headerWrap=document.createElement("div");headerWrap.className="modal-section-header";const hdr=document.createElement("h3");hdr.textContent=sec.title;headerWrap.appendChild(hdr);if(flagField){const flagLbl=document.createElement("label");flagLbl.className="modal-field-bool-wrap";const cb=document.createElement("input");cb.type="checkbox";cb.id="modal-input-"+flagField.yml_field;cb.name=flagField.yml_field;flagLbl.append(cb,document.createTextNode(flagField.name));headerWrap.appendChild(flagLbl)}fieldsDiv.appendChild(headerWrap);const sep=document.createElement("hr");fieldsDiv.appendChild(sep);const grid=document.createElement("div");grid.classList.add("modal-fields-grid");if(sec.title==="Main Fields"){grid.classList.add("main-fields-grid")}sec.fields.forEach((fd=>addYMLFieldInput(fd,grid)));fieldsDiv.appendChild(grid);const sep2=document.createElement("hr");fieldsDiv.appendChild(sep)}));const bundleToVps={backglassBundled:"backglassVPSId",romBundled:"romVPSId",coloredROMBundled:"coloredROMVPSId"};Object.entries(bundleToVps).forEach((([bundleKey,vpsKey])=>{const cbEl=document.getElementById(`modal-input-${bundleKey}`);const vpsEl=document.getElementById(`modal-input-${vpsKey}`);if(cbEl&&vpsEl){vpsEl.disabled=cbEl.checked;cbEl.addEventListener("change",(()=>{vpsEl.disabled=cbEl.checked}))}}));btnClose.onclick=()=>overlay.classList.remove("open");overlay.onclick=e=>{if(e.target===overlay)overlay.classList.remove("open")};btnSubmit.onclick=()=>{let formData={};overlay.querySelectorAll("input,textarea").forEach((inp=>{const key=inp.name;if(!key)return;if(inp.type==="checkbox"){if(inp.closest(".modal-array-group")){formData[key]=formData[key]||[];if(inp.checked)formData[key].push(inp.value)}else{formData[key]=inp.checked}}else if(inp.tagName==="TEXTAREA"){formData[key]=inp.value}else{formData[key]=inp.value}}));onSubmit(formData);overlay.classList.remove("open")};overlay.classList.add("open")}window.addYMLFieldInput=addYMLFieldInput;window.showModal=showModal;